<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goong API æµ‹è¯•é¡µé¢</title>
    <link href='https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.css' rel='stylesheet' />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        #map {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .search-container {
            margin-bottom: 20px;
        }
        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .suggestions {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 5px;
        }
        .suggestion-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .suggestion-item:hover {
            background-color: #f0f0f0;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .result {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .coordinates {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        .coord-input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ Goong API åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•è¶Šå—åœ°å€æœç´¢ã€åœ°å›¾æ˜¾ç¤ºå’Œåœ°ç†ç¼–ç åŠŸèƒ½</p>
        </div>
        
        <div class="content">
            <!-- åœ°å›¾å’Œåœ°å€æœç´¢ -->
            <div class="section">
                <h3>ğŸ“ åœ°å›¾å’Œåœ°å€æœç´¢</h3>
                <div id="map"></div>
                
                <div class="search-container">
                    <input type="text" id="searchInput" class="search-input" 
                           placeholder="è¾“å…¥åœ°å€æœç´¢ (ä¾‹å¦‚: Ho Chi Minh City, Hanoi)">
                    <div id="suggestions" class="suggestions" style="display: none;"></div>
                </div>
                
                <div>
                    <button class="btn" onclick="getCurrentLocation()">ğŸ“ è·å–å½“å‰ä½ç½®</button>
                    <button class="btn" onclick="clearMap()">ğŸ—‘ï¸ æ¸…é™¤æ ‡è®°</button>
                </div>
                
                <div id="mapStatus" class="status" style="display: none;"></div>
            </div>
            
            <!-- APIæµ‹è¯•å·¥å…· -->
            <div class="section">
                <h3>ğŸ”§ API æµ‹è¯•å·¥å…·</h3>
                
                <!-- åœ°å€è‡ªåŠ¨è¡¥å…¨æµ‹è¯• -->
                <div style="margin-bottom: 20px;">
                    <h4>åœ°å€è‡ªåŠ¨è¡¥å…¨</h4>
                    <input type="text" id="autocompleteInput" class="search-input" 
                           placeholder="è¾“å…¥åœ°å€å…³é”®è¯">
                    <button class="btn" onclick="testAutocomplete()">æµ‹è¯•è‡ªåŠ¨è¡¥å…¨</button>
                    <div id="autocompleteResult" class="result"></div>
                </div>
                
                <!-- åå‘åœ°ç†ç¼–ç æµ‹è¯• -->
                <div style="margin-bottom: 20px;">
                    <h4>åå‘åœ°ç†ç¼–ç  (åæ ‡è½¬åœ°å€)</h4>
                    <div class="coordinates">
                        <input type="number" id="latInput" class="coord-input" 
                               placeholder="çº¬åº¦ (ä¾‹å¦‚: 10.762622)" step="any">
                        <input type="number" id="lngInput" class="coord-input" 
                               placeholder="ç»åº¦ (ä¾‹å¦‚: 106.660172)" step="any">
                    </div>
                    <button class="btn" onclick="testReverseGeocode()">æµ‹è¯•åå‘åœ°ç†ç¼–ç </button>
                    <div id="reverseResult" class="result"></div>
                </div>
                
                <!-- åœ°ç†ç¼–ç æµ‹è¯• -->
                <div style="margin-bottom: 20px;">
                    <h4>åœ°ç†ç¼–ç  (åœ°å€è½¬åæ ‡)</h4>
                    <input type="text" id="geocodeInput" class="search-input" 
                           placeholder="è¾“å…¥å®Œæ•´åœ°å€">
                    <button class="btn" onclick="testGeocode()">æµ‹è¯•åœ°ç†ç¼–ç </button>
                    <div id="geocodeResult" class="result"></div>
                </div>
            </div>
        </div>
    </div>

    <script src='https://cdn.jsdelivr.net/npm/@goongmaps/goong-js@1.0.9/dist/goong-js.js'></script>
    <script>
        // Goong API é…ç½®
        const GOONG_API_KEY = '5uo0DOu7oFhOoqtxFhyZemwhmkI0XiFTiq66c0Nj';
        const GOONG_BASE_URL = 'https://rsapi.goong.io';
        
        // è®¾ç½®è®¿é—®ä»¤ç‰Œ
        goongjs.accessToken = GOONG_API_KEY;
        
        // åœ°å›¾å®ä¾‹
        let map;
        let marker;
        let searchTimeout;
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            try {
                map = new goongjs.Map({
                    container: 'map',
                    style: 'https://tiles.goong.io/assets/goong_map_web.json',
                    center: [106.660172, 10.762622], // Ho Chi Minh City
                    zoom: 12
                });
                
                map.on('load', function() {
                    showStatus('mapStatus', 'åœ°å›¾åŠ è½½æˆåŠŸï¼', 'success');
                });
                
                map.on('click', function(e) {
                    const coords = e.lngLat;
                    addMarker(coords.lng, coords.lat);
                    reverseGeocode(coords.lat, coords.lng);
                });
                
            } catch (error) {
                showStatus('mapStatus', 'åœ°å›¾åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ·»åŠ æ ‡è®°
        function addMarker(lng, lat) {
            if (marker) {
                marker.remove();
            }
            
            marker = new goongjs.Marker()
                .setLngLat([lng, lat])
                .addTo(map);
                
            map.flyTo({
                center: [lng, lat],
                zoom: 15
            });
        }
        
        // æ¸…é™¤åœ°å›¾æ ‡è®°
        function clearMap() {
            if (marker) {
                marker.remove();
                marker = null;
            }
        }
        
        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
            element.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 3000);
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, data) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
        }
        
        // åœ°å€æœç´¢è¾“å…¥å¤„ç†
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                hideSuggestions();
                return;
            }
            
            searchTimeout = setTimeout(() => {
                searchAddresses(query);
            }, 300);
        });
        
        // æœç´¢åœ°å€
        async function searchAddresses(query) {
            try {
                const response = await fetch(`${GOONG_BASE_URL}/Place/AutoComplete?api_key=${GOONG_API_KEY}&input=${encodeURIComponent(query)}&limit=5`);
                const data = await response.json();
                
                if (data.status === 'OK' && data.predictions) {
                    showSuggestions(data.predictions);
                } else {
                    hideSuggestions();
                }
            } catch (error) {
                console.error('æœç´¢åœ°å€å¤±è´¥:', error);
                hideSuggestions();
            }
        }
        
        // æ˜¾ç¤ºæœç´¢å»ºè®®
        function showSuggestions(predictions) {
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';
            
            predictions.forEach(prediction => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.textContent = prediction.description;
                item.onclick = () => selectSuggestion(prediction);
                suggestionsDiv.appendChild(item);
            });
            
            suggestionsDiv.style.display = 'block';
        }
        
        // éšè—æœç´¢å»ºè®®
        function hideSuggestions() {
            document.getElementById('suggestions').style.display = 'none';
        }
        
        // é€‰æ‹©æœç´¢å»ºè®®
        async function selectSuggestion(prediction) {
            document.getElementById('searchInput').value = prediction.description;
            hideSuggestions();
            
            // è·å–åœ°ç‚¹è¯¦æƒ…
            try {
                const response = await fetch(`${GOONG_BASE_URL}/Place/Detail?api_key=${GOONG_API_KEY}&place_id=${prediction.place_id}`);
                const data = await response.json();
                
                if (data.status === 'OK' && data.result && data.result.geometry) {
                    const location = data.result.geometry.location;
                    addMarker(location.lng, location.lat);
                    showStatus('mapStatus', `å·²å®šä½åˆ°: ${prediction.description}`, 'success');
                }
            } catch (error) {
                console.error('è·å–åœ°ç‚¹è¯¦æƒ…å¤±è´¥:', error);
            }
        }
        
        // è·å–å½“å‰ä½ç½®
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showStatus('mapStatus', 'æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½', 'error');
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    addMarker(lng, lat);
                    reverseGeocode(lat, lng);
                    showStatus('mapStatus', 'å·²è·å–å½“å‰ä½ç½®', 'success');
                },
                function(error) {
                    showStatus('mapStatus', 'è·å–ä½ç½®å¤±è´¥: ' + error.message, 'error');
                }
            );
        }
        
        // æµ‹è¯•åœ°å€è‡ªåŠ¨è¡¥å…¨
        async function testAutocomplete() {
            const input = document.getElementById('autocompleteInput').value.trim();
            if (!input) {
                alert('è¯·è¾“å…¥åœ°å€å…³é”®è¯');
                return;
            }
            
            try {
                const response = await fetch(`${GOONG_BASE_URL}/Place/AutoComplete?api_key=${GOONG_API_KEY}&input=${encodeURIComponent(input)}&limit=10`);
                const data = await response.json();
                showResult('autocompleteResult', data);
            } catch (error) {
                showResult('autocompleteResult', { error: error.message });
            }
        }
        
        // æµ‹è¯•åå‘åœ°ç†ç¼–ç 
        async function testReverseGeocode() {
            const lat = document.getElementById('latInput').value;
            const lng = document.getElementById('lngInput').value;
            
            if (!lat || !lng) {
                alert('è¯·è¾“å…¥çº¬åº¦å’Œç»åº¦');
                return;
            }
            
            reverseGeocode(lat, lng);
        }
        
        // åå‘åœ°ç†ç¼–ç 
        async function reverseGeocode(lat, lng) {
            try {
                const response = await fetch(`${GOONG_BASE_URL}/Geocode?api_key=${GOONG_API_KEY}&latlng=${lat},${lng}`);
                const data = await response.json();
                showResult('reverseResult', data);
            } catch (error) {
                showResult('reverseResult', { error: error.message });
            }
        }
        
        // æµ‹è¯•åœ°ç†ç¼–ç 
        async function testGeocode() {
            const address = document.getElementById('geocodeInput').value.trim();
            if (!address) {
                alert('è¯·è¾“å…¥åœ°å€');
                return;
            }
            
            try {
                const response = await fetch(`${GOONG_BASE_URL}/Geocode?api_key=${GOONG_API_KEY}&address=${encodeURIComponent(address)}`);
                const data = await response.json();
                showResult('geocodeResult', data);
                
                // å¦‚æœæœ‰ç»“æœï¼Œåœ¨åœ°å›¾ä¸Šæ˜¾ç¤º
                if (data.status === 'OK' && data.results && data.results[0] && data.results[0].geometry) {
                    const location = data.results[0].geometry.location;
                    addMarker(location.lng, location.lat);
                }
            } catch (error) {
                showResult('geocodeResult', { error: error.message });
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°å›¾
        window.addEventListener('load', function() {
            initMap();
            
            // è®¾ç½®é»˜è®¤æµ‹è¯•å€¼
            document.getElementById('latInput').value = '10.762622';
            document.getElementById('lngInput').value = '106.660172';
            document.getElementById('autocompleteInput').value = 'Ho Chi Minh City';
            document.getElementById('geocodeInput').value = 'Há»“ ChÃ­ Minh, Quáº­n 1, PhÆ°á»ng Báº¿n NghÃ©';
        });
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹éšè—å»ºè®®
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-container')) {
                hideSuggestions();
            }
        });
    </script>
</body>
</html>
